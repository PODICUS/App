<!DOCTYPE html>
<html>
	<head>
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta content="utf-8" http-equiv="encoding">
	</head>
	<canvas id='c' width='512' height='512'></canvas>
	<script>
		var w = 512;
		var h = 512;
		var Pi=0;
		var n=1
		var N = 10000;
		var time1 = new Date();
		var N = 512*512*4;
		var img = new Uint8Array(N);
		var Pi=0;
		var n=1;
		//document.write("\n")
		var d1 = new Date();
		for(var i = 0;i < img.length * 1000; i+=4){
			Pi=Pi+(4/n)-(4/(n+2))
			
			img[i] += (n >> 24) % 256;
			img[i+1] += (n >> 16) % 256;
			img[i+2] += (n >> 8) % 256;
			img[i+3] += (n) % 256;
			/*document.write(n)
			if(n % 100 > 90)
				document.write("\n")*/
			n=n+4		
		}
		var d2 = new Date();
		var difference = d2 - d1;

		alert("Pi = " + Pi + " \ntime to calculate: " + difference);
		var cv = document.getElementById('c');
		var gl = cv.getContext('experimental-webgl');
		var tex = gl.createTexture();
		var vbo = gl.createBuffer();
		var program = gl.createProgram();
		gl.bindTexture(gl.TEXTURE_2D, tex);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
		gl.texImage2D(
		    gl.TEXTURE_2D, // target
		    0, // mip level
		    gl.RGBA, // internal format
		    w, h, // width and height
		    0, // border
		    gl.RGBA, //format
		    gl.UNSIGNED_BYTE, // type
		    img // texture data
		);
		gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
		gl.bufferData(gl.ARRAY_BUFFER, 
		              Float32Array([-1, -1,
		               1, -1,
		               1, 1,               
		               1, 1,
		               -1, 1,
		               -1, -1]), gl.STATIC_DRAW);

		program.vs = gl.createShader(gl.VERTEX_SHADER);
		gl.shaderSource(program.vs,
		                "attribute vec4 vertex;\n" +
		                "varying vec2 tc;\n" +
		                "void main(){\n" +
		                " gl_Position = vertex;\n" +
		                " tc = vertex.xy*0.5+0.5;\n" +
		                "}\n");

		program.fs = gl.createShader(gl.FRAGMENT_SHADER);
		gl.shaderSource(program.fs,
		                "precision highp float;\n" +
		                "uniform sampler2D tex;\n" +
		                "varying vec2 tc;\n" +
		                "void main(){\n" +
		                " gl_FragColor = texture2D(tex, tc);\n" +
		                "}\n");

		gl.compileShader(program.vs);
		gl.compileShader(program.fs);

		gl.attachShader(program,program.vs);
		gl.attachShader(program,program.fs);

		gl.deleteShader(program.vs);
		gl.deleteShader(program.fs);
		gl.bindAttribLocation(program, 0, "vertex");
		gl.linkProgram(program);
		gl.useProgram(program);
		gl.enableVertexAttribArray(0);
		gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);
		gl.clear(gl.COLOR_BUFFER_BIT);
		gl.drawArrays(gl.TRIANGLES, 0, 6);
	</script>
</html>